# -*- coding: utf-8 -*-
"""Untitled2.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1KQwkz-I3PNuRVSKJZ95Ko_VNguKFR8iS
"""

!pip install python-telegram-bot
!pip install requests

from telegram.ext import Updater, CommandHandler
from telegram.ext import MessageHandler, Filters
import telegram
import requests
get_response = requests.get(url='https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?json')
data = get_response.json() 
text= ''

for val in data:
      text+='‚Ä¢ <b>' + val['cc']+'</b> - '+ val['txt'] + '\n'
    
def get(bot, update):
  print(update.message.from_user.first_name);
  print(update.message.text);
  title = (update.message.text).split(" ") 
  update.message.reply_text('Hello {}'.format(update.message.from_user.first_name))
  for val in data:
    if val['cc'] == title[1]:
      update.message.reply_text('–ø–æ –∫—É—Ä—Å—É –ù–ë–£ {0} - {1}–≥—Ä–Ω'.format(title[1],val['rate']))

def getAll(bot, update):
    bot.sendMessage(parse_mode='HTML', chat_id=update.message.chat.id, text=' –í–í–ï–î–ò–¢–ï –ö–û–î –í–ê–õ–Æ–¢–´  \n üí∞<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–ª—é—Ç—ã:</b>üí∞ \n  '+text)


def text_callback(bot, update):
  custom_keyboard = [['—Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç', '–∫—É—Ä—Å'],
                       ['–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –≤–∞–ª—é—Ç—É'],]
  reply_markup = telegram.ReplyKeyboardMarkup(custom_keyboard)
  bot.send_message(chat_id=update.message.chat_id, text = "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ..\n üí∂ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç\n üí∂ –∫—É—Ä—Å \n üí∂ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –≤–∞–ª—é—Ç—É ",reply_markup = reply_markup)
    
def get_rate(bot, update):
  bot.sendMessage(parse_mode='HTML', chat_id=update.message.chat.id, text=' <b>–í–í–ï–î–ò–¢–ï –ö–û–î –í–ê–õ–Æ–¢–´</b> üí∞ \n  <i>–Ω–∞–ø—Ä–∏–º–µ—Ä:</i> RUB ',reply_markup=telegram.ReplyKeyboardRemove())
  
def get_rate_2(bot, update):
  for val in data:
    if val['cc'] == update.message.text:
      fl = 1
      update.message.reply_text('üôÄ –ø–æ –∫—É—Ä—Å—É –ù–ë–£ {0} = {1}–≥—Ä–Ω'.format(update.message.text,val['rate']))

def convert(bot, update):
  bot.sendMessage(parse_mode='HTML', chat_id=update.message.chat.id, text=' <b>–í–í–ï–î–ò–¢–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ì–†–ò–í–ï–ù –ò –í–ê–õ–Æ–¢–£</b> üí∞ \n  <i>–Ω–∞–ø—Ä–∏–º–µ—Ä: </i> 3.5 RUB ',reply_markup=telegram.ReplyKeyboardRemove())
  
def convert2(bot, update):
  my_list = update.message.text.split(" ")
  print(my_list[1])
  for val in data:
    if val['cc'] == my_list[1]:
      total = float(my_list[0])*float(val['rate'])
      print(total)
      update.message.reply_text('üôÄ –ø–æ –∫—É—Ä—Å—É –ù–ë–£ {0} –≥—Ä–Ω = {1} {2}'.format(my_list[0], total,  my_list[1]))
  
  
updater = Updater('851425956:AAE4cvbT2hit0L0CBjXWpnD41qdUqEzNm0A')

updater.dispatcher.add_handler(CommandHandler('get', get))
updater.dispatcher.add_handler(MessageHandler(Filters.regex('—Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç'), getAll))
updater.dispatcher.add_handler(MessageHandler(Filters.regex('–∫—É—Ä—Å'), get_rate))
updater.dispatcher.add_handler(MessageHandler(Filters.regex('^[a-zA-Z]{3}$'), get_rate_2))
updater.dispatcher.add_handler(MessageHandler(Filters.regex('–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –≤–∞–ª—é—Ç—É'), convert))
updater.dispatcher.add_handler(MessageHandler(Filters.regex('^[0-9,.]{1,}[ ]{1,}[a-zA-Z]{3}$'), convert2))
updater.dispatcher.add_handler(MessageHandler([Filters.text], text_callback))

updater.start_polling()
updater.idle()